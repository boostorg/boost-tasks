# lists.boost.org
#
# The configuration of virtual host for lists.boost.org
#
# This is the name-based virtual hosts.
#


<VirtualHost *:80>
    ServerName lists.boost.org.cpp.al
    ServerAdmin www@lists.boost.org.cpp.al
    DocumentRoot /home/www/lists.boost.org
    Redirect permanent / https://lists.boost.org.cpp.al/


    CustomLog /var/log/apache2/lists.boost.org/combined_log combined
    CustomLog /var/log/apache2/lists.boost.org/performance_log "%v %r %D"
    ErrorLog /var/log/apache2/lists.boost.org/error_log

    AccessFileName .htaccess_ssl  .htaccess
 
    # Webalizer output
    Alias /webalizer  /l/osl/webalizer/lists.boost.org/

    # Web archives
    Alias /MailArchives/boost        /home/mhonarc-archive/boost/
    Alias /MailArchives/boost-users  /home/mhonarc-archive/boost-users/
    Alias /MailArchives/boost-testing  /home/mhonarc-archive/boost-testing/
    Alias /MailArchives/boost-interest  /home/mhonarc-archive/boost-interest/
    Alias /MailArchives/boost-announce  /home/mhonarc-archive/boost-announce/
    Alias /Old-MailArchives/ublas  /home/mhonarc-archive/ublas/
    Alias /MailArchives/glas       /home/hyper-archives/glas/
    
    Alias /MailArchives/boost-docs /home/hyper-archives/boost-docs/
    Alias /boost        /home/hyper-archives/boost-old/
    Alias /Archives/boost        /home/hyper-archives/boost/
    Alias /boost-users  /home/hyper-archives/boost-users/
    Alias /boost-docs  /home/hyper-archives/boost-docs/
    Alias /threads-devel  /home/hyper-archives/threads-devel/
    Alias /boost-interest  /home/hyper-archives/boost-interest/
    Alias /boost-announce  /home/hyper-archives/boost-announce/
    Alias /MailArchives/ublas  /home/hyper-archives/ublas/

    Alias /boost-build  /home/hyper-archives/boost-build/
    Alias /boost-bugs  /home/hyper-archives/boost-bugs/
    Alias /boost-testing  /home/hyper-archives/boost-testing/
    Alias /boost-commit  /home/hyper-archives/boost-commit/
    Alias /boost-mpi  /home/hyper-archives/boost-mpi/
    Alias /boost-cmake  /home/hyper-archives/boost-cmake/
    Alias /boost-www  /home/hyper-archives/boost-www/
    Alias /boost-maint  /home/hyper-archives/boost-maint/

    Alias /test        /home/hyper-archives/test/
    Alias /test-ciere        /home/hyper-archives/test-ciere/
    Alias /test-list        /home/hyper-archives/test-list/
    Alias /proto        /home/hyper-archives/proto/
    Alias /geometry        /home/hyper-archives/geometry/
    Alias /glas       /home/hyper-archives/glas/
    Alias /ublas  /home/hyper-archives/ublas/

    Alias /.well-known/acme-challenge/ "/var/www/letsencrypt/.well-known/acme-challenge/"
    RewriteEngine ON
    RewriteRule ^mailman/listinfo\.cgi$ /mailman/index.html [L]

    <Directory /home/hyper-archives >
        AllowOverride All
        Require all granted
    </Directory>

    <Directory /home/hyper-archives/boost-old >
        Options MultiViews FollowSymLinks IncludesNoExec 
        Options +ExecCGI
        AddHandler cgi-script .cgi .pl
        AllowOverride FileInfo Indexes
    </Directory>
    
    <Directory /home/mhonarc-archive/boost >
        Options MultiViews FollowSymLinks IncludesNoExec
        Options +ExecCGI
        AddHandler cgi-script .cgi .pl
        AllowOverride FileInfo Indexes
    </Directory>

    # Boost search index built by swish-e
    # This takes care of the following mailing lists
    # boost, boost-announce, boost-build, boost-interest, boost-testing
    # boost-users, threads-devel, ublas 
    ScriptAliasMatch ^/search/(.*)/cgi-bin(.*)  /home/hyper-archives/$1/cgi-bin$2

    #AccessFileName .htaccess_ssl  .htaccess
    <Directory "/home/www/lists.boost.org">
	AddOutputFilterByType DEFLATE text/html text/plain text/xml text/x-js text/css application/x-javascript image/vnd.microsoft.icon

	# Block Morfeus scanning
	RewriteEngine ON
	RewriteCond %{HTTP_USER_AGENT} ^Morfeus
	RewriteRule ^.*$ - [F]
        #AllowOverride All
	#Deny From 66.249.71.204 
	Deny from 31.208.89.229
	Deny from search.msn.com
        Require all granted
    </Directory>

RewriteCond %{SERVER_NAME} =lists.boost.org
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [L,NE,R=permanent]
</VirtualHost>


<VirtualHost *:443>
    ServerName lists.boost.org.cpp.al
    ServerAdmin www@lists.boost.org.cpp.al
    DocumentRoot /home/www/lists.boost.org

    CustomLog /var/log/apache2/lists.boost.org/ssl_combined_log combined
    CustomLog /var/log/apache2/lists.boost.org/ssl_performance_log "%v %r %D"
    ErrorLog /var/log/apache2/lists.boost.org/ssl_error_log

    AccessFileName .htaccess_ssl  .htaccess
 
    # Web archives
    Alias /MailArchives/boost        /home/mhonarc-archive/boost/
    Alias /MailArchives/boost-commit /home/mhonarc-archive/boost-commit/
    Alias /MailArchives/boost-test   /home/mhonarc-archive/boost-test/
    Alias /MailArchives/boost-users  /home/mhonarc-archive/boost-users/
    Alias /MailArchives/boost-testing  /home/mhonarc-archive/boost-testing/
    Alias /MailArchives/boost-interest  /home/mhonarc-archive/boost-interest/
    Alias /MailArchives/boost-announce  /home/mhonarc-archive/boost-announce/
    Alias /Old-MailArchives/ublas  /home/mhonarc-archive/ublas/
    Alias /MailArchives/glas       /home/hyper-archives/glas/
    
    Alias /MailArchives/boost-docs /home/hyper-archives/boost-docs/
    Alias /boost        /home/hyper-archives/boost-old/
    # RedirectMatch "^/boost/(.*)" "/Archives/boost"
    Alias /boost-announce  /home/hyper-archives/boost-announce/
    Alias /Archives/boost        /home/hyper-archives/boost/
    Alias /archives/boost        /home/hyper-archives/boost/
    Alias /boost-users  /home/hyper-archives/boost-users/
    Alias /boost-docs  /home/hyper-archives/boost-docs/
    Alias /threads-devel  /home/hyper-archives/threads-devel/
    Alias /boost-interest  /home/hyper-archives/boost-interest/
    Alias /MailArchives/ublas  /home/hyper-archives/ublas/

    Alias /boost-build  /home/hyper-archives/boost-build/
    Alias /boost-bugs  /home/hyper-archives/boost-bugs/
    Alias /boost-testing  /home/hyper-archives/boost-testing/
    Alias /boost-commit  /home/hyper-archives/boost-commit/
    Alias /boost-mpi  /home/hyper-archives/boost-mpi/
    Alias /boost-cmake  /home/hyper-archives/boost-cmake/
    Alias /boost-maint  /home/hyper-archives/boost-maint/
    Alias /boost-gil  /home/hyper-archives/boost-gil/
    Alias /boost-www  /home/hyper-archives/boost-www/

    Alias /test        /home/hyper-archives/test/
    Alias /test-ciere        /home/hyper-archives/test-ciere/
    Alias /test-list        /home/hyper-archives/test-list/
    Alias /proto        /home/hyper-archives/proto/
    Alias /geometry        /home/hyper-archives/geometry/
    Alias /glas       /home/hyper-archives/glas/
    Alias /ublas  /home/hyper-archives/ublas/
    #
    # Mailgraph: An postfix/sendmail log file analyzer
    #
    Alias /mailgraph    /usr/share/mailgraph

    Alias /.well-known/acme-challenge/ "/var/www/letsencrypt/.well-known/acme-challenge/"
    RewriteEngine ON
    RewriteRule ^/mailman/listinfo\.cgi$ /mailman/index.html [L]

    <Directory /usr/share/mailgraph/>
        AllowOverride None
        Options +ExecCGI
        DirectoryIndex mailgraph.cgi
        AddHandler cgi-script .cgi 
    </Directory>


    <Directory /home/hyper-archives >
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html index.cgi index.pl index.xhtml index.htm
    </Directory>

    <Directory /home/hyper-archives/boost-old >
        Options MultiViews FollowSymLinks IncludesNoExec 
        Options +ExecCGI
        AddHandler cgi-script .cgi .pl
        AllowOverride FileInfo Indexes
    </Directory>

    <Directory /home/mhonarc-archive/boost >
        Options MultiViews FollowSymLinks IncludesNoExec
        Options +ExecCGI
        AddHandler cgi-script .cgi .pl
        AllowOverride FileInfo Indexes
    </Directory>

    # Boost search index built by swish-e
    # This takes care of the following mailing lists
    # boost, boost-announce, boost-build, boost-interest, boost-testing
    # boost-users, threads-devel, ublas 
    ScriptAliasMatch ^/search/(.*)/cgi-bin(.*)  /home/hyper-archives/$1/cgi-bin$2

    #AccessFileName .htaccess_ssl  .htaccess
    <Directory "/home/www/lists.boost.org">
        DirectorySlash Off
	AddOutputFilterByType DEFLATE text/html text/plain text/xml text/x-js text/css application/x-javascript image/vnd.microsoft.icon

	# Block Morfeus scanning
	RewriteEngine ON
	RewriteCond %{HTTP_USER_AGENT} ^Morfeus
	RewriteRule ^.*$ - [F]
        #AllowOverride All
	#Deny From 66.249.71.204 
	Deny from 31.208.89.229
        Require all granted
    </Directory>

    <Directory "/home/www/lists.boost.org/mailman">
        DirectorySlash Off
        Require all granted
    </Directory>

    SSLEngine on

#    SSLCertificateFile /etc/httpd/conf/ssl.crt/star.boost.org-2017.crt
#
#    SSLCertificateKeyFile /etc/httpd/conf/ssl.key/star.boost.org-2017.key
#
#    SSLCertificateChainFile /etc/httpd/conf/ssl.crt/star.boost.org-inter-2017.crt
#    SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256
#    SSLHonorCipherOrder on
#    SSLProtocol TLSv1.2



    SetEnvIf      User-Agent ".*MSIE.*"nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0

    # Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/lists.boost.org.cpp.al/cert.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/lists.boost.org.cpp.al/privkey.pem
    SSLCertificateChainFile /etc/letsencrypt/live/lists.boost.org.cpp.al/chain.pem
</VirtualHost>
